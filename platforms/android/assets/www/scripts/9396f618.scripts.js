$.fn.serializeObject=function(){var a={},b=this.serializeArray();return $.each(b,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a};var cbits={};cbits.getDaysInTreatment=function(){var a=new Date;a.setHours(0,0,0,0);var b=function(a,b){var c=864e5;return Math.round((b.getTime()-a.getTime())/c)};return b(startDate,a)+1};var i18nStrings={};i18nStrings.defaultI10n="pt-BR",i18nStrings.filterLocale=function(a){var b=a||i18nStrings.defaultI10n;return _.where(i18nStrings.generalContent,{l10n:b})},i18nStrings.generalContent=[],i18nStrings.generalContent.push({l10n:"en",language:"English",months:["January","February","March","April","May","June","July","August","September","November","December"],appName:"CONEMO",beginLessonButtonLabel:"Begin",toolBoxLabel:"Toolbox",backLabel:"Back",nextLabel:"Next",configureUserLabel:"Configure Your User Account",contactHelpLabel:"Contact Study Staff",instructionsLabel:"Instructions",instructionsContent:"stuff",contactTypes:["I need help with the app","I need general assistance from my nurse","I am having issues with connectivity"],thankYouAlert:"Thank you, the study staff have been contacted.",unreadLabel:"unread",download:"download",downloaderText:{textDownloadComplete:"Download Complete!",textDownloading:"Downloading",textFile:"file",textFiles:"files",textDownloadingError:"Something went wrong with the download and a report has been sent.",textMissingPlugin:"File transfer plug in is missing. Downloads may not be complete.",textMissingContent:"Please download the most recent content.",textUnavailableMedia:"<p>This media is unavailable.</p>",textUnsupportedFileType:"That file type is not currently supported.",textAlert:"That file type is not currently supported."}}),i18nStrings.generalContent.push({l10n:"pt-BR",language:"Português",months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Septembro","Outubro","Novembro","Dezembro"],appName:"CONEMO",beginLessonButtonLabel:"Iniciar",toolBoxLabel:"Caixa de Ferramentas",backLabel:"Anterior",nextLabel:"Próximo",configureUserLabel:"Configure sua Conta de Usuário",contactHelpLabel:"Equipe do Estudo Contato",instructionsLabel:"Instruções",instructionsContent:"<h2><i class='glyphicon glyphicon-question-sign'></i> Como funciona o App:</h2><ol class='well'><li>3 vezes por semana você deverá fazer o login no aplicativo CONEMO, haverá novas ferramentas e informações cada vez que você acessá-lo</li><li>Cada vez que você fizer seu login, você irá aprender algumas estratégias testadas que são desenvolvidas para mantê-lo mais saudável e feliz</li><li>Se você esquecer de acessar o aplicativo por mais de duas vezes, você será contactado por seu auxiliar de enfermagem para ter certeza de que você continue acessando e participando do programa</li></ol><h2><i class='glyphicon glyphicon-wrench'></i> Caixa de ferramentas</h2><ol class='well'><li>Você pode voltar para ferramentas mais antigas (dos dias anteriores), se você quiser, visitando a caixa de ferramentas</li><li>Se você pular ferramentas ou perdê-las, você pode visitar a caixa de ferramentas para voltar a elas</li></ol> <h2><i class='glyphicon glyphicon-phone'></i> Solicitação de Ajuda</h2> <ol class='well'><li>Se precisar de ajuda a qualquer momento, pressione o botão de Solicitação de ajuda.</li><li>Não se preocupe, você pode pedir ajuda <ol><li>com o aplicativo</li><li>para uma auxiliar de enfermagem com o seu telefone</li></ol>",contactTypes:["Preciso de ajuda com o aplicativo","Preciso de assistência geral da minha Auxiliar de Enfermagem","Estou com problemas em conectar a internet"],thankYouAlert:"Obrigado, a equipe do estudo foram contactados",unreadLabel:"não lido",download:"Baixar",downloaderText:{textDownloadComplete:"Baixado completo!",textDownloading:"Baixando",textFile:"arquivo",textFiles:"arquivos",textDownloadingError:"Something went wrong with the download and a report has been sent.",textMissingPlugin:"File transfer plug in is missing. Downloads may not be complete.",textMissingContent:"Please download the most recent content.",textUnavailableMedia:"<p>This media is unavailable.</p>",textUnsupportedFileType:"That file type is not currently supported.",textAlert:"Testing in spanish"}}),i18nStrings.generalContent.push({l10n:"es-PE",language:"Español",months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],appName:"CONEMO",beginLessonButtonLabel:"Inicio",toolBoxLabel:"Sesiones",backLabel:"Anterior",nextLabel:"Siguiente",configureUserLabel:"Configurar cuenta",contactHelpLabel:"Solicitar ayuda",instructionsLabel:"Instrucciones",instructionsContent:"<h2><i class='glyphicon glyphicon-question-sign'></i> ¿Cómo funciona el aplicativo?</h2><ol class='well'><li>Debes ingresar al aplicativo CONEMO 3 veces a la semana. Cada vez que lo hagas, el aplicativo te dará nueva información y nuevas tareas.</li><li>Cada vez que uses el aplicativo, aprenderás nuevas estrategias para mantenerte sano y feliz.</li><li>Si olvidas ingresar al aplicativo más de 2 veces seguidas, una enfermera te llamará para saber si todo está bien e invitarte a seguir usando CONEMO.</li></ol><h2><i class='glyphicon glyphicon-wrench'></i> Sesiones</h2><ol class='well'><li>Si quieres mirar una de las sesiones anteriores debes apretar el botón “Sesiones” y ahí encontrarás la sesión que quieres usar.</li><li>Si pierdes una sesión o no la haces a tiempo, siempre puedes recuperarla apretando el botón “Sesiones”.</li></ol> <h2><i class='glyphicon glyphicon-phone'></i> Solicitar ayuda</h2> <ol class='well'><li>Si en algún momento necesitas ayuda de la enfermera, por favor aprieta el botón “Solicitar ayuda”.</li><li>Luego elige una de las siguientes alternativas: <ol><li>Necesito ayuda con el aplicativo,</li><li>Necesito ayuda de mi enfermera</li><li>Tengo dificultades con la conexión de internet</li></ol>",contactTypes:["Necesito ayuda con el aplicativo","Necesito ayuda de mi enfermera","Tengo dificultades con la conexión de internet"],thankYouAlert:"Gracias. Tu mensaje ha sido enviado. Tu enfermera o enfermero te llamará pronto.",unreadLabel:"No leído",download:"Descargar",downloaderText:{textDownloadComplete:"Descarga completa!",textDownloading:"Descargando",textFile:"archivo",textFiles:"archivos",textDownloadingError:"Something went wrong with the download and a report has been sent.",textMissingPlugin:"File transfer plug in is missing. Downloads may not be complete.",textMissingContent:"Please download the most recent content.",textUnavailableMedia:"<p>This media is unavailable.</p>",textUnsupportedFileType:"That file type is not currently supported.",textAlert:"Testing in spanish"}});var PurpleRobotClient=new PurpleRobot;if(PurpleRobot.setEnvironment("production"),PurpleRobotClient.setUserId("CONEMO").execute(),"undefined"==typeof localStorage.l10n||"undefined"===localStorage.l10n){var l10n="pt-BR";localStorage.config=JSON.stringify({l10n:l10n})}else var l10n=localStorage.l10n;var l10nStrings=i18nStrings.filterLocale(l10n)[0];if(l10nStrings.availableLocales=_.pluck(i18nStrings.generalContent,"l10n"),"undefined"==typeof localStorage.startDate){var startDate=new Date;startDate.setHours(0,0,0,0),localStorage.startDate=startDate}else{var startDate=new Date(localStorage.startDate),startDateLog={user_id:localStorage.userId,date_created:new Date,start_date:startDate,l10n:localStorage.l10n};PurpleRobotClient.emitReading("start_date",startDateLog).execute()}var lessonsRead=[];"undefined"==typeof localStorage.lessonsRead&&(localStorage.lessonsRead=JSON.stringify([])),angular.module("conemoAppApp",["ngCookies","ngResource","ngSanitize","ngRoute"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/lesson/:id",{templateUrl:"views/lesson.html",controller:"LessonCtrl"}).when("/toolbox",{templateUrl:"views/toolbox.html",controller:"ToolboxCtrl"}).when("/contact",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/contact/:type",{templateUrl:"views/contact.html",controller:"ContactCtrl"}).when("/instructions",{templateUrl:"views/instructions.html",controller:"InstructionsCtrl"}).otherwise({redirectTo:"/"})}]).run(["$rootScope",function(a){a.unreadLabel=l10nStrings.unreadLabel,a.checkLessonRead=function(a){return lessonsRead=JSON.parse(localStorage.lessonsRead),-1!==lessonsRead.indexOf(a)?!0:void 0}}]).run(["$rootScope","LessonService",function(a,b){b.get(function(b){a.lessons=_.where(b.lessons,{l10n:l10n})})}]).run(["$rootScope",function(a){a.downloader=new Downloader,a.downloader.getFileSystem();var b=["https://github.com/cbitstech/conemo_videos/blob/master/LM1.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/LM2.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/LM3.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/LM4.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/SP1.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/SP2.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/SP3.mp4?raw=true","https://github.com/cbitstech/conemo_videos/blob/master/SP4.mp4?raw=true"];a.downloader.setDownloadLinks(b),downloaderGlobal.text=l10nStrings.downloaderText}]).run(function(){function a(){var a=navigator.connection.type,b={};b[Connection.UNKNOWN]="Unknown connection",b[Connection.ETHERNET]="Ethernet connection",b[Connection.WIFI]="WiFi connection",b[Connection.CELL_2G]="Cell 2G connection",b[Connection.CELL_3G]="Cell 3G connection",b[Connection.CELL_4G]="Cell 4G connection",b[Connection.CELL]="Cell generic connection",b[Connection.NONE]="No network connection",localStorage.setItem("connection",b[a])}document.addEventListener("deviceready",a,!1)}).run(["$rootScope",function(){new Date}]),angular.module("conemoAppApp").filter("translate",["$rootScope","conemoConfig",function(a,b){function c(a){var b=_.find(i18nStrings.generalContent,{l10n:d.l10n}),c=new Date,e=c.getMonth();return"undefined"==typeof b?"locale not found: "+d.l10n:"months"===a?b[a][e]:"undefined"==typeof b[a]?"translation not found: "+d.l10n+" => "+a:b[a]}var d=null,e=!1;return function(f){return null===d?(e||(e=!0,b.get().then(function(a){d=a}),a.$on("conemoConfig:changed",function(a,b){d=b})),""):c(f)}}]).filter("reverse",function(){return function(a){return a.slice().reverse()}}),angular.module("conemoAppApp").factory("conemoConfig",["$rootScope",function(a){function b(){}return a.appVersion="0.1.8",b.prototype.get=function(){return $.Deferred().resolve(JSON.parse(localStorage.config))},b.prototype.set=function(b){localStorage.config=JSON.stringify(b),a.$emit("conemoConfig:changed",b)},new b}]).factory("LessonService",["$resource",function(a){return a("scripts/lessons.json")}]),angular.module("conemoAppApp").controller("MainCtrl",["$scope","conemoConfig","$rootScope","$route",function(a,b,c){if("undefined"==typeof localStorage.userId||"undefined"===localStorage.userId)a.showAccountSetup=!0,a.showHomeScreen=!1;else{a.userId=localStorage.userId,a.showAccountSetup=!1,a.showHomeScreen=!1;var d={user_id:localStorage.userId,date_created:new Date,l10n:localStorage.l10n};(new PurpleRobot).emitReading("app_login",d).execute()}a.availableLocales=l10nStrings.availableLocales,a.setLocale=function(){localStorage.l10n=this.locale,b.set({l10n:this.locale})},a.setUserAccountInfo=function(){localStorage.userId=this.userId,window.location.reload()};var e=cbits.getDaysInTreatment(),f=_.sortBy(c.lessons,"dayInTreatment"),g=function(a,b){var c={};return _.each(b,function(b,d){b.dayInTreatment<=a&&(c=b,c.currentSessionIndex=d+1)}),c},h=g(e,f),i=new Date;!function(){if("undefined"==typeof localStorage.triggersScheduled||"undefined"===localStorage.triggersScheduled){PurpleRobotClient.clearTriggers().execute();for(var a=[],b="YYYYMMDDTHHmmss",c=1;c<f.length;c++){var d={releaseDay:moment().add("d",f[c].dayInTreatment),title:f[c].title};a.push(d)}_.each(a,function(a){var c=moment(a.releaseDay).hour(8).minute(0).second(0).format(b),d=moment(c,b).add("minutes",1).format(b);console.log(c);var e=JSON.stringify(a.title),f=e.replace(/\\n/g,"\\n").replace(/\\'/g,"\\'").replace(/\\"/g,'\\"').replace(/\\&/g,"\\&").replace(/\\r/g,"\\r").replace(/\\t/g,"\\t").replace(/\\b/g,"\\b").replace(/\\f/g,"\\f");PurpleRobotClient.updateTrigger({script:PurpleRobotClient.vibrate("buzz").showScriptNotification({title:"CONEMO LESSON:",message:f,isPersistent:!0,isSticky:!1,script:PurpleRobotClient.launchApplication("edu.northwestern.cbits.conemo")}),triggerId:c,startAt:c,endAt:d,repeatRule:"FREQ=DAILY;COUNT=1"}).execute()})}localStorage.setItem("triggersScheduled",moment().toDate())}(),a.userId=localStorage.userId,a.currentLessonTitle=h.title,a.currentLessonDay=i.getDate(),a.l10n=l10n,a.currentSessionIndex=h.currentSessionIndex,a.currentLessonGuid=h.guid}]),angular.module("conemoAppApp").controller("LessonCtrl",["$scope","$routeParams","$sce","$location","$rootScope",function(a,b,c,d,e){var f=$(window).height(),g=($(window).width(),_.where(e.lessons,{guid:b.id})[0]),h=_.sortBy(g.slides,"position"),i=function(a){var b="";return _.each(a,function(a,c){b+='<div style="height:'+f+'px;" class="slide"  data-index="'+c+'" data-position="'+a.position+'">'+a.content+"</div>"}),b=e.downloader.insert("video",b)};a.navButtonGenerator=function(b){1==h.length?(a.showHome=!0,a.showBack=!1,a.showNext=!1):b==h.length-1?(a.showHome=!0,a.showBack=!0,a.showNext=!1):0==b?(a.showHome=!1,a.showBack=!1,a.showNext=!0):(a.showHome=!1,a.showBack=!0,a.showNext=!0)},a.slideNavigator=function(b){if(a.navButtonGenerator(a.currentSlideIndex),"number"!=typeof b)switch(b){case"next":a.currentSlideIndex++;break;case"back":a.currentSlideIndex--}a.pageCounter=a.currentSlideIndex+1+" / "+h.length,$("html, body").animate({scrollTop:f*a.currentSlideIndex+"px"})},a.updatePageCounter=function(){a.currentSlideIndex=Math.round(pageYOffset/f),a.pageCounter=a.currentSlideIndex+1+" / "+h.length,a.navButtonGenerator(a.currentSlideIndex)};var j=cbits.getDaysInTreatment();a.backLabel=l10nStrings.backLabel,a.nextLabel=l10nStrings.nextLabel,a.showSlides=!1,a.slideContent=c.trustAsHtml(i(h)),a.currentSlideIndex=0,a.slideNavigator(a.currentSlideIndex),a.saveForm=function(a){var c={user_id:localStorage.userId,lesson_guid:b.id,days_in_treatment:j,days_in_treatment_assigned:g.dayInTreatment,date_created:new Date,l10n:localStorage.l10n};return c.form_payload=JSON.stringify($("#slideShowForm").serializeObject()),(new PurpleRobot).emitReading("lesson_data",c).execute(),-1===lessonsRead.indexOf(g.guid)&&(lessonsRead.push(g.guid),localStorage.setItem("lessonsRead",JSON.stringify(lessonsRead))),d.path(a),!1}}]).directive("scroll",["$window",function(a){return function(b,c,d){angular.element(a).bind("scroll",function(){b.$apply(d.scroll)})}}]),angular.module("conemoAppApp").controller("ContactCtrl",["$scope",function(a){a.contactHelpLabel=l10nStrings.contactHelpLabel,a.contactTypes=l10nStrings.contactTypes,a.thankYouAlert=l10nStrings.thankYouAlert,a.contactStaff=function(){var b={user_id:localStorage.userId,message:this.contactType,date_created:new Date,l10n:localStorage.l10n};(new PurpleRobot).emitReading("staff_messages",b).execute(),a.successAlertVisible=!0}}]),angular.module("conemoAppApp").controller("InstructionsCtrl",["$scope","$rootScope",function(a,b){a.instructionsLabel=l10nStrings.instructionsLabel,a.downloadLabel=l10nStrings.download,a.downloadVideos=function(){b.downloader.downloadMultiple()},a.downloadLessons=function(){b.downloader.downloadSingle("https://conemo.northwestern.edu/lesson_api/lessons.json","android_asset/www/scripts/")},a.prompt=function(){var a=new PurpleRobot;a.showNativeDialog({title:"CONEMO",message:"Login no aplicativo CONEMO",buttonLabelA:"Sim",buttonLabelB:"Noo",scriptA:a.launchApplication("edu.northwestern.cbits.conemo"),scriptB:a.doNothing()}).execute()}}]),angular.module("conemoAppApp").controller("ToolboxCtrl",["$scope","$rootScope",function(a,b){var c=new Date;c.setHours(0,0,0,0);var d=function(a,b){var c=864e5;return Math.round((b.getTime()-a.getTime())/c)},e=d(startDate,c)+1;a.availableLessons=_.filter(b.lessons,function(a){return a.dayInTreatment<=e}),a.beginLessonButtonLabel=l10nStrings.beginLessonButtonLabel}]);